# Request Handling

## Table of Contents

1. [Handlers](#handlers)
2. [Request Body](#request-body)
3. [Request Params](#request-params)
4. [Request Query](#request-query)
5. [Request Headers](#request-headers)

## Handlers

A handler in Ecewo is very similar to Express.js. Handlers take two parameters: `Req *req` and `Res *res` objects.

```c
#include "ecewo.h"

void hello_world(Req *req, Res *res)
{
    send_text(res, 200, "Hello, World!");
}
```

## Request Body

```c
#include "ecewo.h"
#include <stdio.h>

void print_body(Req *req, Res *res)
{
    printf("Body: %s\n", req->body);
    send_text(res, 200, "Success!");
}
```

## Request Params

Let’s take a specific user by params. We can access the params using the `get_params(req, "slug");` function. Let’s write a handler that gives us the `slug`:

```c
#include "ecewo.h"

void send_params(Req *req, Res *res)
{
    const char *user_id = get_params(req, "id");
    const char *action = get_params(req, "action");

    if (user_id == NULL || action == NULL)
    {
        send_text(res, 400, "Missing parameter");
        return;
    }

    send_text(res, 200, "Success!");
}

int main(void)
{
    if (server_init() != SERVER_OK)
    {
        fprintf(stderr, "Failed to initialize server\n");
        return 1;
    }

    // Route with parameters
    get("/users/:id/:action", user_handler);
    // Matches: /users/123/edit, /users/456/delete, etc.

    if (server_listen(3000) != SERVER_OK)
    {
        fprintf(stderr, "Failed to start server\n");
        return 1;
    }

    server_run();
    return 0;
}
```

Compile the program and send a request to:

```
http://localhost:3000/send-params/testslug
```

Server will send us `testslug` response.

## Request Query

Just like the params, we can use `get_query(req, "query");` to get the query params. Let’s rewrite a handler using query:

```c
#include "ecewo.h"

void print_query(Req *req, Res *res)
{
    const char *name = get_query(req, "name");
    const char *surname = get_query(req, "surname");

    if (name == NULL || surname == NULL)
    {
        send_text(res, 400, "Missing required parameter.");
        return;
    }

    printf("Name: %s Surname: %s\n", name, surname);

    send_text(res, 200, "Success!");
}

int main(void)
{
    if (server_init() != SERVER_OK)
    {
        fprintf(stderr, "Failed to initialize server\n");
        return 1;
    }

    get("/print-query", print_query);

    if (server_listen(3000) != SERVER_OK)
    {
        fprintf(stderr, "Failed to start server\n");
        return 1;
    }

    server_run();
    return 0;
}
```

Let’s compile the program and send a request to:

```
http://localhost:3000/print-query?name=john&surname=doe
```

We’ll receive a `Success!` response and the query strings will be printed in the console:

```
Name: john Surname: doe
```

## Request Headers

Just like params and query, we can also access request headers using the `get_headers(req, "header");` function. Ecewo also provides different functions for authorization and session-based authentication. However, if you simply want to access a specific item in `req->headers`, you can do so directly.

Typically, a standard `GET` request with POSTMAN have some headers like:

```json
{
    "User-Agent": "PostmanRuntime/7.43.3",
    "Accept": "*/*",
    "Postman-Token": "9b1c7dda-27f9-471a-9cdd-bfaf0d5b56a1",
    "Host": "localhost:3000",
    "Accept-Encoding": "gzip, deflate, br",
    "Connection": "keep-alive"
}
```

Let’s say, we need the `User-Agent` header:

```c
#include "ecewo.h"

void get_user_agent(Req *req, Res *res)
{
    const char *user_agent = get_headers(req, "User-Agent");

    if (user_agent == NULL)
    {
        send_text(res, 400, "Missing required parameter.");
        return;
    }

    send_text(res, 200, user_agent);
}

int main(void)
{
    if (server_init() != SERVER_OK)
    {
        fprintf(stderr, "Failed to initialize server\n");
        return 1;
    }

    // Register the route
    get("/header", get_user_agent);

    if (server_listen(3000) != SERVER_OK)
    {
        fprintf(stderr, "Failed to start server\n");
        return 1;
    }

    server_run();
    return 0;
}
```

Let’s send a request via POSTMAN:

```
http://localhost:3000/header
```

The result will be something like this:

```
User Agent: PostmanRuntime/7.43.3
```
