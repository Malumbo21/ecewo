# Timers

Ecewo provides JavaScript-like `set_timeout()` and `set_interval()` functions, implemented with the libuv event loop, for non-blocking time-based operations.

## One-time Delay

Ecewo provides `set_timeout()` that executes a callback function for one-time after a specified delay.

Signature:
```c
uv_timer_t *set_timeout(timer_callback_t callback, uint64_t delay_ms, void *user_data);
```

**Parameters:**

- callback: The callback function to execute
- delay_ms: Delay time in milliseconds
- user_data: User data to pass to callback (can be NULL)

**Return Value:**

- Success: Timer handle (uv_timer_t*)
- Failure: NULL

### Simple Usage:

```c
void show_welcome_notification(void *user_data)
{
    char *username = (char*)user_data;
    printf("Welcome %s! Thanks for joining us!\n", username);
    // Send notification to user's browser
}

// After user registers
set_timeout(show_welcome_notification, 2000, username);
```

### Advanced Usage

```c
// Session Timeout Warning

void warn_session_expiring(void *user_data)
{
    int *user_id = (int*)user_data;
    printf("Warning: Session for user %d expires in 5 minutes!\n", *user_id);
    
    // Send warning to user's browser
    send_session_warning(*user_id);
}

void expire_user_session(void *user_data)
{
    int *user_id = (int*)user_data;
    printf("Session expired for user %d\n", *user_id);
    
    // Log out user
    logout_user(*user_id);
    free(user_data);
}

// Set up session timeouts when user logs in
void setup_session_timeout(int user_id)
{
    int *uid1 = malloc(sizeof(int));
    int *uid2 = malloc(sizeof(int));
    *uid1 = user_id;
    *uid2 = user_id;
    
    // Warn 5 minutes before expiry (25 minutes)
    set_timeout(warn_session_expiring, 25 * 60 * 1000, uid1);
    
    // Expire after 30 minutes
    set_timeout(expire_user_session, 30 * 60 * 1000, uid2);
}
```

## Periodic Task

Ecewo provides `set_interval()` that executes a callback function repeatedly at specified intervals.

Signature:
```c
uv_timer_t *set_interval(timer_callback_t callback, uint64_t interval_ms, void *user_data);
```

**Parameters:**

- callback: The callback function to execute
- interval_ms: Repeat interval in milliseconds
- user_data: User data to pass to callback (can be NULL)

**Return Value:**

- Success: Timer handle (uv_timer_t*)
- Failure: NULL

### Simple Usage:

```c
void print_current_time(void *user_data)
{
    time_t now = time(NULL);
    printf("Current time: %s", ctime(&now));
}

// Print time every 10 seconds
void start_time_display()
{
    set_interval(print_current_time, 10000, NULL);
}
```

### Advanced Usage

```c
// Auto-Save User Work

typedef struct
{
    int user_id;
    char *document_content;
} document_t;

void auto_save_document(void *user_data)
{
    document_t *doc = (document_t*)user_data;
    
    printf("Auto-saving document for user %d...\n", doc->user_id);
    
    // Save to database here
    save_to_database(doc->user_id, doc->document_content);
    
    printf("Document saved successfully!\n");
}

// Auto-save every 30 seconds
void start_auto_save(int user_id, char *content)
{
    document_t *doc = malloc(sizeof(document_t));
    doc->user_id = user_id;
    doc->document_content = strdup(content);
    
    set_interval(auto_save_document, 30000, doc);
}
```

## Timer Cancellation

Ecewo provides `clear_timer()` that cancels a created timer. It is useful for long-time processes.

```c
void clear_timer(uv_timer_t *timer);
```

**Parameters:**

- timer: Timer handle to cancel

### Simple Usage

```c
uv_timer_t *hello_timer = NULL;

void say_hello(void *user_data)
{
    printf("Hello!\n");
}

void start_hello_timer(void)
{
    hello_timer = set_interval(say_hello, 2000, NULL);
    printf("Started\n");
}

void stop_hello_timer(void)
{
    if (hello_timer) {
        clear_timer(hello_timer);
        hello_timer = NULL;
        printf("Timer stopped by user\n");
    }
}
```

### Advanced Usage

```c
uv_timer_t *email_timer = NULL;

void send_email(void *user_data)
{
    char *email = (char*)user_data;
    printf("ðŸ“§ Email sent to: %s\n", email);
    email_timer = NULL;
    free(email);
}

void schedule_email(const char *recipient)
{
    char *email = strdup(recipient);
    printf("Email scheduled for %s (will send in 5 seconds)\n", recipient);
    email_timer = set_timeout(send_email, 5000, email);
}

void cancel_email(void)
{
    if (email_timer) {
        clear_timer(email_timer);
        email_timer = NULL;
        printf("Scheduled email cancelled\n");
    }
}
```
