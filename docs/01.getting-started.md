# Getting Started

## Table Of Contents

1. [Requirements](#requirements)
2. [Installation](#installation)
3. [Run Server](#run-server)

## Requirements

- A C compiler
- CMake version 3.14 or higher

## Installation

`CMakeLists.txt`:
```cmake
cmake_minimum_required(VERSION 3.14)
project(myproject VERSION 1.0.0 LANGUAGES C)

include(FetchContent)

FetchContent_Declare(
    ecewo
    GIT_REPOSITORY https://github.com/savashn/ecewo.git
    GIT_TAG v2.1.0
)

FetchContent_MakeAvailable(ecewo)

add_executable(${PROJECT_NAME} 
    main.c
)

target_link_libraries(${PROJECT_NAME} PRIVATE ecewo)
```

> [!NOTE]
>
> This builds `STATIC` library by default. If you need `SHARED` library, add `set(ECEWO_BUILD_SHARED ON CACHE BOOL "" FORCE)`.

> [!WARNING]
>
> If you are working on Windows and you need shared library, you need to add the following lines into your `CMakeLists.txt`:

```cmake
if(WIN32 AND ECEWO_BUILD_SHARED)
    target_compile_definitions(${PROJECT_NAME} PRIVATE ECEWO_DLL)

    if(TARGET ecewo)
        add_custom_command(TARGET ${PROJECT_NAME} POST_BUILD
            COMMAND ${CMAKE_COMMAND} -E copy_if_different
            $<TARGET_FILE:ecewo>
            $<TARGET_FILE_DIR:${PROJECT_NAME}>
        )
    endif()
    
    if(TARGET uv)
        add_custom_command(TARGET ${PROJECT_NAME} POST_BUILD
            COMMAND ${CMAKE_COMMAND} -E copy_if_different
            $<TARGET_FILE:uv>
            $<TARGET_FILE_DIR:${PROJECT_NAME}>
        )
    endif()
    
    if(TARGET llhttp_shared)
        add_custom_command(TARGET ${PROJECT_NAME} POST_BUILD
            COMMAND ${CMAKE_COMMAND} -E copy_if_different
            $<TARGET_FILE:llhttp_shared>
            $<TARGET_FILE_DIR:${PROJECT_NAME}>
        )
    endif()
endif()
```

## Run Server

```c
// main.c

#include "ecewo.h"   // Ecewo API
#include <stdio.h>

void hello_world(Req *req, Res *res)
{
    send_text(res, 200, "Hello, World!");
}

int main(void)
{
    if (server_init() != SERVER_OK)
    {
        fprintf(stderr, "Failed to initialize server\n");
        return 1;
    }

    // Register the route
    get("/", hello_world);

    if (server_listen(3000) != SERVER_OK)
    {
        fprintf(stderr, "Failed to start server\n");
        return 1;
    }

    server_run();
    return 0;
}
```

Let's explain this `main.c` file step by step:

- Ecewo provides all its features in `ecewo.h`.

- The `void hello_world()` function is a handler. We pass the `Req *req` parameter to reach the request, and pass the `Res *res` parameter to prepare the response. We send a plain text response using `send_text()`, and it also frees the memory that allocated by the handler automatically. We'll see request handling more detailed in the [Request Handling](docs/request-handling.md) chapter.

- The `int main(void)` function is the entry point of the program. We need to initialize and start the server in that function.

- The server must be initialized first, and should start listening last. In between, we can register routes and initialize other dependencies.

Let's run the following commands in the terminal to build the server:

```shell
mkdir build && cd build && cmake .. && cmake --build .
```

Let's run it:
```shell
// Linux/macOS:
./server

// Windows
./server.exe
```
